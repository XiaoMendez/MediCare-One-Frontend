---
import MainLayout from "../layouts/MainLayout.astro";
import { api } from "../lib/api.js";

let error = null;

if (Astro.request.method === "POST") {
  const data = await Astro.request.formData();
  const email = data.get("email");
  const password = data.get("password");

  try {
    const res = await api.login(email, password);
    Astro.cookies.set("token", res.token, { path: "/" });
    return Astro.redirect("/dashboard");
  } catch {
    error = "Credenciales inválidas";
  }
}
---

<MainLayout title="Login | MediCare One">
  <div class="flex flex-col items-center justify-center h-screen gap-4 w-80 mx-auto">
    <h2 class="text-2xl font-bold text-purple-700">Iniciar sesión</h2>

    {error && <p class="text-red-600 text-sm">{error}</p>}

    <form method="POST" class="flex flex-col gap-3 w-full">
      <input name="email" placeholder="Email" class="border p-2 rounded" required />
      <input name="password" type="password" placeholder="Contraseña" class="border p-2 rounded" required />
      <button class="bg-purple-700 text-white p-2 rounded">Entrar</button>
    </form>
  </div>
</MainLayout>
